# Performance & Bundle Size

Rarog изначально спроектирован так, чтобы:

- full‑сборка была предсказуемой и стабильной;
- JIT‑режим давал **заметное** уменьшение итогового CSS;
- было понятно, как получить минимальный бандл без магии.

## Full vs JIT (концептуально)

Условный пример (ориентировочные, не жёсткие цифры):

| Тип проекта                      | Режим | Размер CSS (сырой) | Gzip‑оценка |
|----------------------------------|-------|---------------------|-------------|
| Малый лендинг                    | full  | 70–90 KB            | 15–25 KB    |
| Малый лендинг                    | jit   | 20–35 KB            | 6–12 KB     |
| Admin‑панель (dashboard)         | full  | 90–130 KB           | 25–35 KB    |
| Admin‑панель (dashboard)         | jit   | 35–60 KB            | 10–20 KB    |

Точные значения зависят от:

- используемых компонентов и утилит;
- объёма layout‑ов и вариаций;
- количества responsive/state/variant‑классов.

## Режимы сборки

В `rarog.config.*`:

```ts
const config: RarogConfig = {
  mode: "jit", // или "full"
  // ...
};
```

- `mode: "full"` — генерируется полный CSS: все утилиты, компоненты, темы.
- `mode: "jit"` — JIT‑движок анализирует `content` и собирает только используемые классы.

## Как работает JIT (кратко)

JIT ищет классы в:

- `class="..."` в HTML/Blade/шаблонах;
- `className="..."` в JSX/TSX;
- `element.classList.add('btn', 'btn-primary')` в JS;
- `clsx('btn', isActive && 'btn-primary')` и аналогичных вызовах (`cx`, `classnames`).

Он поддерживает:

- responsive‑префиксы (`sm:`, `md:`, `lg:`, `xl:`);
- state‑префиксы (`hover:`, `focus:`, `group-hover:`, `peer-checked:` и т.д.);
- arbitrary values (`w-[320px]`, `bg-[#0f172a]`, `rounded-[1.5rem]`, ...).

## Рекомендации по оптимизации

### 1. Чистые `content`‑пути

В `rarog.config.*` следи, чтобы `content`:

- охватывал только реальные шаблоны/компоненты;
- **не** включал большие vendor‑директории и автогенерируемые файлы.

Плохо:

```ts
content: ["./**/*.php", "./**/*.js"]
```

Хорошо:

```ts
content: [
  "./resources/views/**/*.blade.php",
  "./resources/js/**/*.{js,jsx,ts,tsx}",
  "./components/**/*.{vue,ts,tsx}"
]
```

### 2. Избегать конкатенации

Не делай:

```ts
const cls = "btn-" + variant;      // JIT это не увидит
```

Лучше:

```ts
const cls = variant === "primary" ? "btn btn-primary" : "btn btn-secondary";
```

или:

```ts
clsx("btn", variant === "primary" && "btn-primary");
```

### 3. Ограниченные arbitrary values

Арbitrary‑классы (`w-[320px]`, `bg-[#0f172a]`) удобны, но злоупотребление ими
может раздуть CSS за счёт множества уникальных значений.

Рекомендация:

- использовать токены там, где это возможно (`w-64`, `bg-primary-600`);
- arbitrary — для редких edge‑кейсов и прототипирования.

### 4. Отдельные бандлы для тем

Если у тебя несколько тем:

- default / dark / contrast и т.п.,
- можно собирать их в отдельные файлы:

  - `rarog.theme.default.css`,
  - `rarog.theme.dark.css`,
  - `rarog.theme.contrast.css`.

И подгружать только нужное (через `<link>` или динамический импорт).

## Проверка размеров

Рекомендуется:

```bash
# сборка
rarog build

# оценка размеров (Linux/macOS)
gzip -c dist/rarog.jit.css | wc -c
gzip -c dist/rarog.css | wc -c
```

Так можно сравнить full vs JIT на реальном проекте.

---

Для деталей и примеров использования см. также:

- [Variants & JIT](/variants-jit)
- разделы гайдов по конкретным стекам (Laravel/React/Next.js).


## Performance v2 и размеры бандлов

Для Rarog 3.x мы разделяем несколько сценариев сборки:

- **full** — полный набор токенов, утилит и компонент;
- **jit** — только реально используемые классы по анализу `content`;
- **split** — несколько CSS-бандлов под разные части системы (публичный сайт, админка и т.п.).

Рекомендуемый подход:

1. На стадии прототипа — использовать full-сборку (быстрый старт).
2. Для production — включить `mode: "jit"` в `rarog.config.*` и
   ограничить `content` только реальными путями проекта.
3. Для больших систем — рассмотреть split-сборку:
   - общий foundation (tokens + base utilities),
   - отдельный бандл для admin UI,
   - отдельный бандл для публичной витрины/лендингов.

Также важно:

- кешировать результаты JIT-сборки (особенно в CI) — это поддерживается
  через стандартные механизмы кеша (`node_modules/.cache`, CI cache);
- по возможности не держать «мертвые» layout-страницы в одном репо
  без необходимости — JIT всё равно увидит классы и не сможет их выкинуть.
